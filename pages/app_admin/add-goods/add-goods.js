(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/app_admin/add-goods/add-goods"],{"1f69":function(e,t,i){"use strict";i.r(t);var a=i("3e36"),o=i.n(a);for(var r in a)"default"!==r&&function(e){i.d(t,e,function(){return a[e]})}(r);t["default"]=o.a},"2d44":function(e,t,i){},"31e0":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.set_attr=!e.set_attr},e.e1=function(t){e.is_default_services=!e.is_default_services})},o=[];i.d(t,"a",function(){return a}),i.d(t,"b",function(){return o})},"3e36":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(i("a34a")),o=i("2f62"),r=n(i("d5ea"));function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t,i,a,o,r,n){try{var s=e[r](n),c=s.value}catch(d){return void i(d)}s.done?t(c):Promise.resolve(c).then(a,o)}function c(e){return function(){var t=this,i=arguments;return new Promise(function(a,o){var r=e.apply(t,i);function n(e){s(r,a,o,n,c,"next",e)}function c(e){s(r,a,o,n,c,"throw",e)}n(void 0)})}}function d(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,a)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?d(i,!0).forEach(function(t){g(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):d(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function g(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var l={data:function(){return{postageIndex:-1,height:0,give_integral:0,forehead_integral:0,windowHeight:0,beSubmit:!1,inputName:!0,form:{cats:[],name:"",cost_price:"",price:"",original_price:"",type:"goods",plugin_data:{ecard:{ecard_id:0}},attr_default_name:"默认规格"},cats:[],forehead:-1,unit:"件",iphone_x:!1,set_attr:!1,is_default_services:!0,modal:!1,error:!1,set_cat:!1,set_postage:!1,set_service:!1,set_card:!1,confine:!1,is_service:!1,goods_card:[],img:[],card:[],goods_detail:[],beMove:!1,service:[],postage:[],bePostage:"",beService:[],default_service:[],newIndex:"0",index:"0",attr:!1,have_children:!1,disabled:!0,imgHidden:!0,flag:!1,x:0,y:0,id:0,first_service:!0,choose_list:[],elements:[],img_src:"",dialog:!1,loading:!1,ecard_dialog:!1,is_ecard:0,ecard_api_url:"",ecardBePostage:"",ecard_postage:[],ecard_set_postage:!1,ecard_postageIndex:-1,beginIndex:null}},computed:u({},(0,o.mapState)({theme:function(e){return e.mallConfig.theme},userInfo:function(e){return e.user.info},adminImg:function(e){return e.mallConfig.__wxapp_img.app_admin}})),methods:{changeConfine:function(){this.confine=!this.confine,this.confine&&-1==this.form.confine_count&&(this.form.confine_count="")},money:function(e){var t=e.toString();return 0==t.indexOf(".")&&(t="0"+t),t=t.replace(/[^\d.]/g,""),t=t.replace(/\.{2,}/g,"."),t=t.replace(".","$#$").replace(/\./g,"").replace("$#$","."),t=t.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"),t.indexOf(".")<0&&""!=t&&(t=parseFloat(t)),+t},costChange:function(e){this.form.cost_price=this.money(e.detail.value)},originalChange:function(e){this.form.original_price=this.money(e.detail.value)},priceChange:function(e){this.form.price=this.money(e.detail.value)},nameBlur:function(){this.inputName=!this.inputName},catchTouchMove:function(){return!1},toSubmit:function(){var t=this;if(t.loading)return!1;e.showLoading({title:"提交中..."}),t.loading=!0,t.beSubmit=!1,t.$request({url:t.$api.app_admin.edit,data:{form:JSON.stringify(t.form),attrGroups:JSON.stringify(t.form.attr_groups)},method:"post"}).then(function(i){t.loading=!1,t.$hideLoading(),e.hideLoading(),t.loading=!1,0==i.code&&0==i.code?(e.showToast({title:i.msg,duration:1e3}),setTimeout(function(){e.navigateBack()},500)):e.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(i){t.loading=!1,t.$hideLoading(),e.hideLoading()})},submit:function(e){var t=!1,i=this,a=i.form,o=[];if(!(i.img.length>0))return i.error="请上传商品图片",!1;if(a.pic_url=i.img,!a.name)return i.error="请设置商品名称",!1;if(0==i.cats.length)return i.error="请设置商品分类",!1;for(var r in i.cats)o.push(i.cats[r].value);if(!i.unit)return i.error="请设置商品单位",!1;if(a.unit=i.unit,0!=a.cost_price&&!a.cost_price)return i.error="请设置商品成本价",!1;if(a.cost_price<0)return i.error="成本价不得小于零",!1;if(0!=a.original_price&&!a.original_price)return i.error="请设置商品原价",!1;if(a.original_price<0)return i.error="商品原价不得小于零",!1;if(0!=a.price&&!a.price)return i.error="请设置商品售价",!1;if(i.set_attr){if(a.use_attr=1,a.goods_num=0,!a.attr_groups||0==a.attr_groups.length)return i.error="请设置商品规格",!1;t=!0}else{if(a.use_attr=0,a.attr=[],!a.goods_num)return i.error="商品库存不得为空",!1;if(a.goods_num<0)return i.error="商品库存不得小于零",!1;t=!0}if(a.cards=i.goods_card,a.is_default_services=1,a.services=[],i.confine||(i.form.confine_count=-1),0==i.is_default_services&&(a.is_default_services=0,i.beService.length>0&&(a.services=i.beService)),a.status=e,!(i.goods_detail.length>0))return i.error="请设置图文描述",!1;for(var n in a.detail="",i.goods_detail)"img"==i.goods_detail[n].type?a.detail+='<p><img src="'+i.goods_detail[n].pic_url+'"/></p>':"line"==i.goods_detail[n].type?a.detail+='<p><img src="'+i.adminImg.line+'"/></p>':"text"==i.goods_detail[n].type&&(a.detail+="<p>"+i.goods_detail[n].text+"</p>");a.mchCats||(a.mchCats=[]),i.forehead_integral&&(i.forehead_integral>0?(a.forehead_integral_type=1,a.forehead_integral=i.forehead_integral):(a.forehead_integral_type=2,a.forehead_integral=i.forehead_integral.replace("%",""))),i.give_integral&&(i.give_integral>0?(a.give_integral_type=1,a.give_integral=i.give_integral):(a.give_integral_type=2,a.give_integral=i.give_integral.replace("%",""))),a.virtual_sales||(a.virtual_sales=0),a.cover_pic||(a.cover_pic=""),a.sort||(a.sort=100),a.accumulative||(a.accumulative=1),a.member_price||(a.member_price={}),a.freight_id=i.bePostage.id,a.freight=i.bePostage,a.individual_share||(a.individual_share=0),a.is_level||(a.is_level=0),a.individual_share||(a.individual_share=0),a.video_url||(a.video_url=""),t&&(i.form=a,i.form.cats=o,i.id>0&&(i.form.id=i.id),0==e?i.toSubmit():i.beSubmit=!0)},close:function(){this.error=null,this.modal=!1,this.beSubmit=!1},inputAttr:function(e){this.attr[e].attr_list[0].attr_id=(+e+2).toString()},_longtap:function(t,i,a){var o=this,r=e.createSelectorQuery(),n=r.selectAll(".move-img");n.fields({dataset:!0,rect:!0},function(e){o.elements=e}).exec(),o.img[i].pic_url="",o.x=a.currentTarget.offsetLeft,o.y=a.currentTarget.offsetTop,o.imgHidden=!1,o.flag=!0,o.beMove=!0,o.img_src=t,o.beginIndex=i},touchend:function(e){var t=this;if(t.flag){for(var i=e.changedTouches[0].pageX,a=e.changedTouches[0].pageY,o=t.elements,r=t.img,n=t.beginIndex,s=0;s<o.length;s++){var c=o[s];if(i>c.left&&i<c.right&&a>c.top&&a<c.bottom){var d=c.dataset.index;if(n<d){for(var u=r[n],g=n;g<d;g++)r[g]=r[g+1];r[d]=u}if(n>d){for(var l=r[n],f=n;f>d;f--)r[f]=r[f-1];r[d]=l}r[d].pic_url=t.img_src,t.img=r}}t.img[n].pic_url||(t.img[n].pic_url=t.img_src),t.imgHidden=!0,t.flag=!1,t.beMove=!1,t.beginIndex=null}},touchm:function(e){if(this.flag){var t=e.touches[0].pageX,i=e.touches[0].pageY;this.x=t-60,this.y=i-189}},cancelService:function(){var t=this.beService,i=this.service;t.length>0?i.forEach(function(e,i){e.isChoose=!1,t.forEach(function(t){t.id==e.id&&(e.isChoose=!0)})}):i.forEach(function(e,t){e.isChoose=!1}),this.beService=t,this.service=i,this.set_service=!1,this.is_service=!1,setTimeout(function(t){e.pageScrollTo({scrollTop:45550,duration:0})},0)},submitService:function(){var t=[];this.service.forEach(function(e){e.isChoose&&t.push(e)}),this.beService=t,this.set_service=!1,this.is_service=!1,setTimeout(function(t){e.pageScrollTo({scrollTop:45550,duration:0})},0)},choose:function(e){var t=this;t.service.forEach(function(i){i.id==e.id&&(i.isChoose=!i.isChoose,t.$forceUpdate())})},toGoodsDetail:function(){e.navigateTo({url:"/pages/app_admin/goods-detail/goods-detail"})},addImg:function(){var t=this,i=9-t.img.length;e.chooseImage({count:i,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){var a=i.tempFilePaths,o=t.img;a.forEach(function(i,n){e.showLoading({title:"上传中..."});var s="";(0,r.default)({url:t.$api.upload.file,filePath:i,fileType:"image",fileName:s,mch_id:0}).then(function(i){var r=null;r=JSON.parse(i.data),0===r.code&&o.push({pic_url:r.data.url,id:r.data.id}),t.img=o,n===a.length-1&&e.hideLoading()}).catch(function(t){t&&t.errMsg&&e.showModal({title:"错误",content:t.errMsg,showCancel:!1})})})}})},del_img:function(e){this.img.splice(e,1)},chooseCat:function(){e.navigateTo({url:"/pages/app_admin/goods-cat/goods-cat"})},chooseAttr:function(){e.navigateTo({url:"/pages/app_admin/goods-attr/goods-attr"}),e.setStorage({key:"goods_unit",data:this.unit})},bindChange:function(e){this.newIndex=e.detail.value[0]},toggle:function(e){this.choose_list=[],this.dialog=!1,this.set_cat=!1,1==e?this.set_postage&&(this.bePostage=this.postage[this.newIndex]):this.set_postage=!1},chooseService:function(){var t=this;t.first_service?t.$request({url:t.$api.app_admin.service}).then(function(i){if(t.$hideLoading(),0==i.code){t.service=i.data.list,0==i.data.list.length?t.modal=!0:t.is_service=!0;var a=[],o=!0,r=!1,n=void 0;try{for(var s,c=i.data.list[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var d=s.value;d.isChoose=!1,1==d.is_default&&(a.push(d),d.isChoose=!0)}}catch(u){r=!0,n=u}finally{try{o||null==c.return||c.return()}finally{if(r)throw n}}t.set_service=!0,t.beService=a,t.default_service=a,t.first_service=!1}else e.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(){t.$hideLoading()}):0==t.service.length?t.modal=!0:t.is_service=!0},chooseCard:function(){var t=this;t.$request({url:t.$api.app_admin.card}).then(function(i){t.$hideLoading(),0==i.code?(t.card=i.data.list,0==i.data.list.length?(t.set_card=!0,t.modal=!0):e.navigateTo({url:"/pages/app_admin/goods-card/goods-card"})):e.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(){t.$hideLoading()})},chooseExpress:function(){var t=this;t.$request({url:t.$api.app_admin.postage}).then(function(i){if(t.$hideLoading(),0==i.code)if(0==i.data.list.length)t.set_postage=!0,t.modal=!0,t.postage=i.data.list;else{var a=[];i.data.list.forEach(function(e,t){a.push(i.data.list[t].id)});var o=a.indexOf(t.bePostage.id);o>-1?(t.postageIndex=o,t.newIndex=o):t.bePostage="",t.set_postage=!0,t.dialog=!0,t.postage=i.data.list}else e.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(){t.$hideLoading()})},getService:function(t){var i=this;this.$request({url:this.$api.app_admin.service}).then(function(a){i.$hideLoading();var o=a.code,r=a.data,n=a.msg;if(0===o){for(var s in i.service=r.list,i.service)i.service[s].isChoose=!1;if(t>0)for(var c in i.beService)for(var d in i.service)i.service[d].id==i.beService[c].id&&(i.service[d].isChoose=!0,i.first_service=!1);else i.beService=[],r.list.forEach(function(e){e.isChoose=!1,1==e.is_default&&(i.beService.push(e),e.isChoose=!0)})}else e.showToast({title:n,icon:"none",duration:1e3})}).catch(function(){i.$hideLoading()})},getPostage:function(t){var i=this;this.$request({url:this.$api.app_admin.postage}).then(function(a){if(i.$hideLoading(),0==a.code){if(i.postage=a.data.list,t>0)return!1;i.bePostage="",a.data.list.forEach(function(e){1==e.status&&(i.bePostage=e)})}else e.showToast({title:a.msg,icon:"none",duration:1e3})}).catch(function(){i.$hideLoading()})},getCard:function(){var t=this;this.$request({url:this.$api.app_admin.card}).then(function(i){t.$hideLoading(),0==i.code?t.card=i.data.list:e.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(){t.$hideLoading()})},getDetail:function(){var t=c(a.default.mark(function t(i){var o,r,n,s,c,d,u,g,l,f,h,_,p,v,m,y,b,S,w,x,$,T,O,P,C,k;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$request({url:this.$api.app_admin.goods_edit,data:{id:i}});case 2:return o=t.sent,r=o.code,n=o.data,s=o.msg,t.next=6,this.$hideLoading();case 6:if(this.getService(i),this.getPostage(i),0===r){for(C in this.form=n.detail,c=this.form,d=c.pic_url,u=c.cats,g=c.use_attr,l=c.services,f=c.freight,h=c.cards,_=c.confine_count,p=c.is_default_services,v=c.forehead_integral,m=c.forehead_integral_type,y=c.give_integral,b=c.give_integral_type,S=c.attr_groups,w=c.attr,x=c.detail,$=c.unit,this.img=d,this.cats=u,this.set_attr=g,this.beService=l,this.bePostage=f,this.goods_card=h,this.unit=$,_>0&&(this.confine=!0),0==p&&(this.is_default_services=!1),this.forehead_integral=+v,2==m&&(this.forehead_integral=v+"%"),this.give_integral=+y,2==b&&(this.give_integral=y+"%"),S.length>0&&w.length>0&&(this.attr=!0,e.setStorage({key:"goods_attr_groups",data:S}),e.setStorage({key:"goods_attr",data:w})),T=x.split(/<\/p>|<br\/>|<img /),O=[],P=void 0,T)T[C]=T[C].replace(/<p>/g,"").replace(/<\/p>/g,""),P={type:""},T[C].indexOf("src")>-1?(P.type="img",P.id="",P.pic_url=T[C].slice(5,T[C].length-3)):(P.type="text",P.text=T[C]),O[C]=P;for(k in O)""===O[k].text&&O.splice(k,1);this.goods_detail=O,e.setStorage({key:"goods_card",data:h}),e.setStorage({key:"goods_cat",data:this.cats}),e.setStorage({key:"goods_detail",data:O})}else e.showToast({title:s,icon:"none",duration:1e3});case 9:case"end":return t.stop()}},t,this)}));function i(e){return t.apply(this,arguments)}return i}(),chooseECard:function(){var t=this;0===this.id&&this.$request({url:this.$api.app_admin.ecard_api_url+this.ecard_api_url}).then(function(i){var a=i.code,o=i.data,r=i.msg;if(t.$hideLoading(),0===a)if(0===o.length)t.ecard_set_postage=!0,t.ecard_postage=o;else{var n=[];o.forEach(function(e,t){n.push(o[t].id)});var s=n.indexOf(t.form.plugin_data.ecard.ecard_id);s>-1?(t.ecard_postageIndex=s,t.newIndex=s):t.form.plugin_data.ecard={ecard_id:0,name:""},t.ecard_set_postage=!0,t.ecard_dialog=!0,t.ecard_postage=o}else e.showToast({title:r,icon:"none",duration:1e3})}).catch(function(){t.$hideLoading()})},typeChange:function(e){0===this.id&&(this.form.type=e.target.value)},getGoodsConfig:function(){var e=c(a.default.mark(function e(){var t;return a.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$request({url:this.$api.app_admin.goods_config});case 2:t=e.sent,0===t.code&&(this.is_ecard=t.data.is_ecard,this.ecard_api_url=t.data.ecard_api_url);case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),ecardToggle:function(e){this.ecard_dialog=!1,1==e?this.ecard_set_postage&&(this.form.plugin_data.ecard={ecard_id:this.ecard_postage[this.newIndex].id,name:this.ecard_postage[this.newIndex].name}):this.ecard_set_postage=!1}},onLoad:function(t){var i=this;e.getSystemInfo({success:function(e){i.windowHeight=e.windowHeight,(e.model.indexOf("iPhone X")>-1||e.model.indexOf("iPhone 11")>-1||e.model.indexOf("iPhone11")>-1||e.model.indexOf("iPhone12")>-1||e.model.indexOf("Unknown Device")>-1)&&(i.iphone_x=!0)}}),e.getSystemInfo({success:function(e){var t=e.windowHeight,a=e.windowWidth,o=750/a;i.height=t*o}}),i.getCard(),i.getGoodsConfig(),e.removeStorage({key:"goods_card",success:function(){i.goods_card=[]}}),e.removeStorage({key:"goods_cat"}),e.removeStorage({key:"goods_unit"}),e.removeStorage({key:"goods_attr_groups"}),e.removeStorage({key:"goods_attr"}),e.removeStorage({key:"temp_attr"}),e.removeStorage({key:"temp_attr_info"}),e.removeStorage({key:"goods_detail",success:function(){i.goods_detail=[]}}),t.id>0?(i.$showLoading({type:"global",text:"加载中..."}),i.id=t.id,setTimeout(function(){e.setNavigationBarTitle({title:"编辑商品"}),i.getDetail(t.id)},500)):(i.getService(),i.getPostage())},onShow:function(){var t=this;e.getStorage({key:"goods_card",success:function(e){t.goods_card=e.data}}),e.getStorage({key:"goods_cat",success:function(e){t.cats=e.data}}),e.getStorage({key:"goods_detail",success:function(e){t.goods_detail=e.data}}),e.getStorage({key:"goods_attr_groups",success:function(e){t.form.attr_groups=e.data,t.attr=!0}}),e.getStorage({key:"goods_attr",success:function(e){t.form.attr=e.data}}),e.removeStorage({key:"temp_attr"}),e.removeStorage({key:"temp_attr_info"})},watch:{"form.type":{handler:function(e){"goods"===e&&(this.form.plugin_data.ecard.ecard_id=0,this.form.plugin_data.ecard.name="")},deep:!0}}};t.default=l}).call(this,i("543d")["default"])},"4a48":function(e,t,i){"use strict";var a=i("2d44"),o=i.n(a);o.a},6683:function(e,t,i){"use strict";i.r(t);var a=i("31e0"),o=i("1f69");for(var r in o)"default"!==r&&function(e){i.d(t,e,function(){return o[e]})}(r);i("4a48");var n=i("2877"),s=Object(n["a"])(o["default"],a["a"],a["b"],!1,null,"29ede610",null);t["default"]=s.exports},ae58:function(e,t){e.exports=require("../siteinfo.js")}},[["8e27","common/runtime","common/vendor"]]]);