(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/page-component/app-attr/app-attr"],{"3eba":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i("2f62");function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)}return i}function s(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(i,!0).forEach(function(e){o(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var a=function(){return i.e("components/page-component/app-member-mark/app-member-mark").then(i.bind(null,"1ed7"))},u=function(){return i.e("components/page-component/goods/app-price").then(i.bind(null,"6c9f"))},c=function(){return i.e("components/basic-component/app-input/app-input").then(i.bind(null,"75e2"))},l=function(){return i.e("components/basic-component/app-image/app-image").then(i.bind(null,"f54c"))},h=function(){return i.e("components/basic-component/app-iphone-x/app-iphone-x").then(i.bind(null,"7598"))},p={name:"app-attr",components:{appMemberMark:a,appPrice:u,appInput:c,"app-image":l,"app-iphone-x":h},props:{goods:Object,attrGroupList:Array,attrCart:{type:Array,default:function(){return[]}},cartShow:{type:Boolean,default:function(){return!0}},previewUrl:String,submitUrl:String,goodsId:{type:Number,default:function(){return 0}},show:Number,buyText:{type:String,default:function(){return"立即购买"}},plugin:{default:""},theme:{type:String,default:"classic-red"},chooseNumber:{type:Boolean,default:!0},noPay:{type:Boolean,default:!1},buyClick:{type:Boolean,default:!1},addText:{type:String,default:"加入购物车"},is_show_buy:{type:Boolean,default:!0},sign:{type:String}},data:function(){return{display:"none",number:1,selectAttr:null,newAttrGroupList:null,pic_url:null}},watch:{show:function(){"block"===this.display?(this.selectAttr=null,this.close()):"none"===this.display&&this.alert()},newData:{handler:function(){this.$emit("attr",this.newData)},immediate:!0},attrGroupList:{handler:function(){this.newAttrGroupList=this.attrGroupList,"block"==this.display&&this.alert()},immediate:!0},goods:{handler:function(){"block"==this.display&&this.alert()},immediate:!0}},methods:{alert:function(){if(0!==this.attrGroupList.length){var t=this.attrGroupList,e=this.goods.attr,i=null;if(this.number=1,1===t.length){for(var r in e)for(var n in t[0].attr_list)t[0].attr_list[n].attr_id==e[r].attr_list[0].attr_id&&(e[r].stock>0?(1===e.length&&(t[0].attr_list[n].checked=!0),t[0].attr_list[n].attr_num_0=!1,this.pic_url=t[0].attr_list[n].pic_url):(this.number=0,t[0].attr_list[n].checked=!1,t[0].attr_list[n].attr_num_0=!0));1===e.length&&(i=e[0],this.$emit("attrtap",i))}this.display="block",this.newAttrGroupList=t,this.goods.selectAttr?this.selectAttr=this.goods.selectAttr:this.selectAttr=i}},close:function(){this.display="none"},preventD:function(){},storeAttrClick:function(e,i){var r=JSON.parse(JSON.stringify(this.newAttrGroupList)),n=this.goods.attr,s=[],o=this.attrCart;for(var a in r)for(var u in r[a].attr_list){var c=r[a].attr_list[u];if(parseInt(r[a].attr_group_id)==parseInt(i))if(parseInt(c.attr_id)===parseInt(e)){if(c.checked?c.checked=!1:c.checked=!0,c.attr_num_0)return}else c.checked=!1;c.checked&&(0==a&&(this.pic_url=r[0].attr_list[u].pic_url),s.push(r[a].attr_group_id+"-"+c.attr_id))}function l(t,e){return e.some(function(e){return t==e})}var h=[],p=null,d=1;for(var m in n){var f=[],b=0;for(var _ in n[m].attr_list){var g=n[m].attr_list[_].attr_group_id+"-"+n[m].attr_list[_].attr_id;l(g,s)||(b+=1,f.push(g))}if(0==n[m].stock&&b<=1&&(h=h.concat(f)),0==b){if(p||(p={}),p=n[m],o.forEach(function(t){t.attr_id==p.id&&(d=t.num)}),p.stock<=0)return void t.showToast({title:"库存不足",icon:"none"});p.stock<=d&&(d=p.stock)}}for(var y in 0==s.length&&(p=null),r)for(var v in r[y].attr_list){var w=r[y].attr_list[v],A=r[y].attr_group_id+"-"+w.attr_id;l(A,h)&&!l(A,s)?w.attr_num_0=!0:w.attr_num_0=!1}this.newAttrGroupList=r,this.selectAttr=p,this.number=d,this.$emit("attrtap",this.selectAttr)},numberBlur:function(e){return e=parseInt(e.value),e>this.attrNum&&(t.showToast({title:"库存不足",icon:"none"}),e=this.attrNum),this.$emit("attrtap",this.selectAttr),this.number=e},numberSub:function(){var t=this.number;if(t<=1)return!0;t--,this.number=t,this.$emit("attrtap",this.selectAttr)},numberAdd:function(){var e=this.number;if(e++,e>this.attrNum)return t.showToast({title:"库存不足",icon:"none"}),void(this.number=this.attrNum);this.number=e,this.$emit("attrtap",this.selectAttr)},cart:function(){var e=this;if(!this.submit())return!1;var i=this.selectAttr;"pick"!==this.goods.sign?"goods"===this.goods.type?"miaosha"===this.goods.sign?this.$request({url:this.$api.miaosha.add_cart,data:{miaosha_goods_id:i.goods_id,attr_id:i.id,num:this.number},method:"post"}).then(function(i){t.showToast({title:i.msg,type:"success"}),e.display="none",e.selectAttr.number=e.number,e.$emit("selectNumber",e.selectAttr)}).catch(function(){e.display="none"}):"flash_sale"===this.goods.sign?this.$request({url:this.$api.flash_sale.add_cart,data:{flash_goods_id:i.goods_id,attr_id:i.id,num:this.number},method:"post"}).then(function(i){t.showToast({title:i.msg,type:"success"}),e.display="none",e.selectAttr.number=e.number,e.$emit("selectNumber",e.selectAttr)}).catch(function(){e.display="none"}):this.$request({url:this.$api.cart.add,data:{goods_id:i.goods_id,attr:i.id,num:this.number},method:"post"}).then(function(i){0===i.code?(t.showToast({title:i.msg,type:"success"}),e.display="none",e.selectAttr.number=e.number,e.$emit("selectNumber",e.selectAttr)):(t.showToast({title:i.msg,icon:"none",duration:2500}),e.display="none")}).catch(function(t){e.display="none"}):"ecard"===this.goods.type&&t.showToast({title:"虚拟商品不允许加入购物车",icon:"none"}):this.$emit("add",i,this.number)},buy:function(){if(!this.submit())return!1;if(this.noPay)this.$emit("pay",this.number);else{if(this.buyClick)return this.display="none",this.selectAttr.number=this.number,this.$emit("buyClick",this.selectAttr),!1;var e=this.goods,i=this.number,r=this.selectAttr,n=r.id,s=[];for(var o in r.attr_list)s.push({attr_id:r.attr_list[o].attr_id,attr_group_id:r.attr_list[o].attr_group_id});var a=[{mch_id:e.mch_id?e.mch_id:0,goods_list:[{id:this.goodsId?this.goodsId:e.id,attr:s,num:i,cat_id:0,goods_attr_id:n}]}],u="/pages/order-submit/order-submit?mch_list=".concat(JSON.stringify(a));this.submitUrl&&this.previewUrl&&(u+="&preview_url=".concat(encodeURIComponent(this.previewUrl),"&submit_url=").concat(encodeURIComponent(this.submitUrl),"&plugin=").concat(this.plugin)),t.navigateTo({url:u})}},submit:function(){var e=this.goods,i=this.number,r=this.selectAttr;return r?r.stock<=0?(t.showToast({title:"库存不足",icon:"none"}),!1):i<=0?(t.showToast({title:"数量不能为0",icon:"none"}),!1):!!e:(t.showToast({title:"请先选规格",icon:"none"}),!1)},clickImg:function(e){t.previewImage({current:0,urls:[e]})}},computed:s({},(0,r.mapState)({gConfig:function(t){return t.gConfig}}),{attrPic:function(){return this.pic_url?this.pic_url:this.goods?this.goods.cover_pic:""},priceColor:function(){return this.goods&&1===this.goods.level_show?"member":this.theme+"-color"},attrNum:function(){return this.selectAttr?this.selectAttr.stock:this.goods?this.goods.goods_num:0},attrPrice:function(){return this.selectAttr?1===this.goods.level_show?this.selectAttr.price_member:this.selectAttr.price:this.goods?"undefined"!==typeof this.goods.price_min?this.goods.price_min:this.goods.price:0},newData:function(){var t=this.number,e=this.display,i=this.selectAttr;return{number:t,display:e,selectAttr:i}}},(0,r.mapGetters)("iPhoneX",{boolEmpty:"getBoolEmpty"}))};e.default=p}).call(this,i("543d")["default"])},6956:function(t,e,i){"use strict";var r=i("8e79"),n=i.n(r);n.a},"8e79":function(t,e,i){},"90da":function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement;t._self._c},n=[];i.d(e,"a",function(){return r}),i.d(e,"b",function(){return n})},a8f8:function(t,e,i){"use strict";i.r(e);var r=i("3eba"),n=i.n(r);for(var s in r)"default"!==s&&function(t){i.d(e,t,function(){return r[t]})}(s);e["default"]=n.a},d3c4:function(t,e,i){"use strict";i.r(e);var r=i("90da"),n=i("a8f8");for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);i("6956");var o=i("2877"),a=Object(o["a"])(n["default"],r["a"],r["b"],!1,null,"2424626d",null);e["default"]=a.exports}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/page-component/app-attr/app-attr-create-component',
    {
        'components/page-component/app-attr/app-attr-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("d3c4"))
        })
    },
    [['components/page-component/app-attr/app-attr-create-component']]
]);                
